% Digital Finance Course - Beamer Template
% Based on template_beamer_final.tex with backward compatibility for df* colors
% Purple/Lavender color scheme (Madrid theme)

\documentclass[8pt,aspectratio=169]{beamer}
\usetheme{Madrid}

% ======================= PACKAGES =======================
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{adjustbox}
\usepackage{multicol}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows, positioning, calc, shadows, trees, fit, decorations.pathreplacing}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{hyperref}

% ======================= NEW COLOR SCHEME (ml* colors) =======================
% Primary purple/lavender theme colors
\definecolor{mlblue}{RGB}{0,102,204}
\definecolor{mlpurple}{RGB}{51,51,178}
\definecolor{mllavender}{RGB}{173,173,224}
\definecolor{mllavender2}{RGB}{193,193,232}
\definecolor{mllavender3}{RGB}{204,204,235}
\definecolor{mllavender4}{RGB}{214,214,239}
\definecolor{mlorange}{RGB}{255, 127, 14}
\definecolor{mlgreen}{RGB}{44, 160, 44}
\definecolor{mlred}{RGB}{214, 39, 40}
\definecolor{mlgray}{RGB}{127, 127, 127}

% Additional utility colors
\definecolor{lightgray}{RGB}{240, 240, 240}
\definecolor{midgray}{RGB}{180, 180, 180}

% ======================= BACKWARD COMPATIBLE COLORS (df* colors) =======================
% These preserve the ORIGINAL RGB values from the old template
% TikZ diagrams will retain their original blue/teal appearance
% This is intentional for visual consistency in existing diagrams
\definecolor{dfblue}{RGB}{0,102,204}
\definecolor{dfteal}{RGB}{0,153,153}
\definecolor{dfred}{RGB}{204,51,51}
\definecolor{dfgreen}{RGB}{51,153,51}
\definecolor{dforange}{RGB}{255,153,0}
\definecolor{dfgray}{RGB}{128,128,128}
\definecolor{dflightblue}{RGB}{230,242,255}
\definecolor{dflightblue2}{RGB}{204,229,255}
\definecolor{dflightblue3}{RGB}{179,217,255}
\definecolor{dflightblue4}{RGB}{153,204,255}
\definecolor{dfcyan}{RGB}{51,187,204}
\definecolor{dfpurple}{RGB}{148, 103, 189}
\definecolor{codebg}{RGB}{245, 245, 245}

% ======================= APPLY PURPLE/LAVENDER THEME =======================
\setbeamercolor{palette primary}{bg=mllavender3,fg=mlpurple}
\setbeamercolor{palette secondary}{bg=mllavender2,fg=mlpurple}
\setbeamercolor{palette tertiary}{bg=mllavender,fg=white}
\setbeamercolor{palette quaternary}{bg=mlpurple,fg=white}

\setbeamercolor{structure}{fg=mlpurple}
\setbeamercolor{section in toc}{fg=mlpurple}
\setbeamercolor{subsection in toc}{fg=mlblue}
\setbeamercolor{title}{fg=mlpurple}
\setbeamercolor{frametitle}{fg=mlpurple,bg=mllavender3}
\setbeamercolor{block title}{bg=mllavender2,fg=mlpurple}
\setbeamercolor{block body}{bg=mllavender4,fg=black}

% ======================= BEAMER SETTINGS =======================
% Remove navigation symbols
\setbeamertemplate{navigation symbols}{}

% Clean itemize/enumerate
\setbeamertemplate{itemize items}[circle]
\setbeamertemplate{enumerate items}[default]

% Reduce margins for more content space
\setbeamersize{text margin left=5mm,text margin right=5mm}

% ======================= LISTINGS CONFIGURATION =======================
\lstdefinestyle{soliditystyle}{
    language=Java,
    basicstyle=\ttfamily\scriptsize,
    keywordstyle=\color{mlpurple}\bfseries,
    stringstyle=\color{mlorange},
    commentstyle=\color{mlgray}\itshape,
    numberstyle=\tiny\color{mlgray},
    numbers=left,
    numbersep=5pt,
    backgroundcolor=\color{codebg},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    frame=single,
    rulecolor=\color{midgray},
    tabsize=2,
    captionpos=b,
    breaklines=true,
    breakatwhitespace=false,
    escapeinside={(*@}{@*)},
    xleftmargin=10pt,
    xrightmargin=10pt,
    morekeywords={pragma,solidity,contract,function,returns,public,private,view,pure,payable,address,uint256,mapping,event,modifier,require,emit,external,internal,msg,sender,value,memory,storage}
}

\lstdefinestyle{pythonstyle}{
    language=Python,
    basicstyle=\ttfamily\scriptsize,
    keywordstyle=\color{mlpurple}\bfseries,
    stringstyle=\color{mlorange},
    commentstyle=\color{mlgray}\itshape,
    numberstyle=\tiny\color{mlgray},
    numbers=left,
    numbersep=5pt,
    backgroundcolor=\color{codebg},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    frame=single,
    rulecolor=\color{midgray},
    tabsize=4,
    captionpos=b,
    breaklines=true,
    breakatwhitespace=false,
    escapeinside={(*@}{@*)},
    xleftmargin=10pt,
    xrightmargin=10pt
}

\newcommand{\code}[1]{\texttt{\color{mlpurple}#1}}

% ======================= TIKZ STYLES =======================
% Node styles for diagrams (using ml* colors for new diagrams)
\tikzstyle{blockchain} = [rectangle, rounded corners, minimum width=2cm,
    minimum height=1cm, text centered, draw=mlpurple, fill=mllavender3]
\tikzstyle{process} = [rectangle, minimum width=2cm, minimum height=0.8cm,
    text centered, draw=mlpurple, fill=mllavender4]
\tikzstyle{transaction} = [circle, minimum size=0.8cm,
    text centered, draw=mlpurple, fill=mllavender2]
\tikzstyle{arrow} = [thick, ->, >=stealth]
\tikzstyle{decision} = [diamond, minimum width=3cm, minimum height=1cm, text centered, draw=mlpurple, fill=mllavender4, thick]
\tikzstyle{smartcontract} = [rectangle, rounded corners, minimum width=2cm, minimum height=0.8cm, text centered, draw=mlpurple, fill=mllavender2, thick, font=\small]
\tikzstyle{pool} = [ellipse, minimum width=2.5cm, minimum height=1.5cm, text centered, draw=mlpurple, fill=mllavender3, thick]
\tikzstyle{aibox} = [rectangle, rounded corners, minimum width=2.5cm, minimum height=0.8cm, text centered, draw=mlpurple, fill=mllavender3, thick]
\tikzstyle{convergebox} = [rectangle, rounded corners, minimum width=2cm, minimum height=0.8cm, text centered, draw=mlorange, fill=mlorange!15, thick]

% ======================= CUSTOM COMMANDS =======================
% Compact list command (used AFTER \begin{itemize})
\newcommand{\compactlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Bottom annotation (Madrid-style footer note)
\newcommand{\bottomnote}[1]{%
\vfill
\vspace{-2mm}
\textcolor{mllavender2}{\rule{\textwidth}{0.4pt}}
\vspace{1mm}
\footnotesize
\textbf{#1}
}

% ======================= FINANCE MACROS =======================
% Common financial notation
\newcommand{\usd}[1]{\$#1}
\newcommand{\eur}[1]{\texteuro#1}
\newcommand{\pct}[1]{#1\%}

% Finance notation macros
\newcommand{\E}{\mathbb{E}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\Cov}{\mathrm{Cov}}
\newcommand{\Prob}{\mathbb{P}}
\newcommand{\R}{\mathbb{R}}

% ======================= CHART PLACEHOLDER =======================
\newcommand{\chartplaceholder}[2][5cm]{%
\begin{center}
\begin{adjustbox}{max width=0.95\textwidth, max height=#1}
\framebox[\textwidth][c]{%
\rule{0pt}{#1}%
\textcolor{midgray}{[#2]}%
}
\end{adjustbox}
\end{center}
}

% ======================= FOOTER TEMPLATE =======================
\setbeamertemplate{footline}{
    \hbox{\begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1ex,leftskip=.5em,rightskip=.5em]{author in head/foot}
    \tiny
    \textbf{Digital Finance} \hfill
    Joerg Osterrieder \hfill
    \insertdate \hfill
    Page \insertframenumber{} / \inserttotalframenumber
    \end{beamercolorbox}}
}

% ======================= SECTION DIVIDER TEMPLATE =======================
\AtBeginSection[]{
\begin{frame}[plain]
\vfill
\centering
\begin{beamercolorbox}[sep=12pt,center]{title}
\usebeamerfont{title}\LARGE\insertsection\par
\end{beamercolorbox}
\vfill
\end{frame}
}
