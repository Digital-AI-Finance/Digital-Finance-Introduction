<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz 1.4: Landscape Overview | Introduction to Digital Finance</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        :root {
            --mlpurple: #3333B2;
            --mlblue: #0066CC;
            --quiz-accent: #8b5cf6;
            --quiz-light: #ede9fe;
            --correct: #22c55e;
            --correct-bg: #dcfce7;
            --incorrect: #ef4444;
            --incorrect-bg: #fee2e2;
            --bg: #f6f8fa;
            --card-bg: #ffffff;
            --text: #24292e;
            --text-secondary: #586069;
            --border: #e1e4e8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
            min-height: 100vh;
        }

        .nav {
            background: linear-gradient(135deg, var(--mlpurple), var(--mlblue));
            color: white;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-title { font-weight: 600; font-size: 14px; }
        .nav-links { display: flex; gap: 16px; }
        .nav-links a { color: white; text-decoration: none; font-size: 12px; opacity: 0.9; }
        .nav-links a:hover { opacity: 1; }

        .quiz-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 0 4px;
        }
        .quiz-title { font-size: 16px; font-weight: 600; color: var(--mlpurple); }
        .quiz-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
        }
        .stat-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        .stat-progress { background: var(--quiz-light); color: var(--quiz-accent); }
        .stat-score { background: var(--correct-bg); color: var(--correct); }

        .progress-bar-container {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-bottom: 12px;
        }
        .progress-bar {
            height: 100%;
            background: var(--quiz-accent);
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Three-column layout */
        .questions-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 12px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            min-height: 280px;
        }

        .question-card.answered { opacity: 0.7; }

        .question-card.correct-card {
            border: 2px solid var(--correct);
            background: linear-gradient(to bottom, var(--correct-bg), var(--card-bg));
        }

        .question-card.incorrect-card {
            border: 2px solid var(--incorrect);
            background: linear-gradient(to bottom, var(--incorrect-bg), var(--card-bg));
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .q-number {
            background: var(--quiz-light);
            color: var(--quiz-accent);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .q-status { font-size: 14px; }

        .q-text {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-grow: 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-grow: 1;
        }

        .option-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            min-height: 44px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--card-bg);
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            font-size: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--quiz-accent);
            background: var(--quiz-light);
        }

        .option-btn.correct {
            border-color: var(--correct);
            background: var(--correct-bg);
        }

        .option-btn.incorrect {
            border-color: var(--incorrect);
            background: var(--incorrect-bg);
        }

        .option-btn.disabled { cursor: default; }

        .option-letter {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 10px;
            flex-shrink: 0;
        }

        .option-btn.correct .option-letter {
            background: var(--correct);
            color: white;
        }

        .option-btn.incorrect .option-letter {
            background: var(--incorrect);
            color: white;
        }

        .option-text { flex: 1; }

        .feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            line-height: 1.4;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: var(--correct-bg); color: #166534; }
        .feedback.incorrect { background: var(--incorrect-bg); color: #991b1b; }

        /* Results */
        .results-card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 32px;
            text-align: center;
            max-width: 500px;
            margin: 40px auto;
            display: none;
        }
        .results-card.show { display: block; }
        .results-icon { font-size: 48px; margin-bottom: 8px; }
        .results-score { font-size: 36px; font-weight: 700; color: var(--quiz-accent); }
        .results-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
        .results-grade {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .grade-a { background: #dcfce7; color: #166534; }
        .grade-b { background: #dbeafe; color: #1e40af; }
        .grade-c { background: #fef3c7; color: #92400e; }
        .grade-d { background: #fed7aa; color: #9a3412; }
        .grade-f { background: #fee2e2; color: #991b1b; }

        .results-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        .btn-primary { background: var(--quiz-accent); color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-secondary { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }

        /* Next button container */
        .next-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }
        .btn-next {
            padding: 10px 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: var(--quiz-accent);
            color: white;
            transition: all 0.2s;
            display: none;
        }
        .btn-next:hover { background: #7c3aed; transform: scale(1.02); }
        .btn-next.show { display: inline-block; }
        .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }

        @media (max-width: 900px) {
            .questions-row { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .questions-row { grid-template-columns: 1fr; }
            .question-card { min-height: auto; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-title">Quiz 1.4: Landscape Overview</div>
        <div class="nav-links">
            <a href="../index.html">Dashboard</a>
            
            <a href="https://github.com/Digital-AI-Finance/Digital-Finance-Introduction" target="_blank">GitHub</a>
        </div>
    </nav>

    <main class="quiz-container">
        <div class="quiz-header">
            <div class="quiz-title">Quiz 1.4: Landscape Overview</div>
            <div class="quiz-stats">
                <span class="stat-badge stat-progress" id="progressBadge">0/20</span>
                <span class="stat-badge stat-score" id="scoreBadge">Score: 0</span>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="questions-row" id="questionsRow"></div>

        <div class="next-btn-container">
            <button class="btn-next" id="nextBtn" onclick="loadNextQuestions()">Next</button>
        </div>

        <div class="results-card" id="resultsCard">
            <div class="results-icon" id="resultsIcon"></div>
            <div class="results-score" id="resultsScore"></div>
            <div class="results-label">Correct Answers</div>
            <div class="results-grade" id="resultsGrade"></div>
            <div class="results-buttons">
                <button class="btn btn-primary" onclick="restartQuiz()">Try Again</button>
                <a href="../index.html" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>
    </main>

    <script>
        const quizData = {
            questions: [
                {
                                "id": 1,
                                "question": "Which of the following is NOT one of the six main sectors in the digital finance landscape?",
                                "options": {
                                                "A": "Payments",
                                                "B": "Manufacturing",
                                                "C": "Lending",
                                                "D": "Insurance"
                                },
                                "correct": "B",
                                "explanation": "The six main sectors of digital finance are: Payments, Lending, Trading & Exchanges, Investing & Wealth Management, Insurance, and Banking Infrastructure. Manufacturing is not part of the digital finance landscape, though financial services may be embedded in manufacturing business models.",
                                "difficulty": "easy"
                },
                {
                                "id": 2,
                                "question": "What is the primary difference between FinTech and Crypto/DeFi approaches?",
                                "options": {
                                                "A": "FinTech is more expensive than Crypto/DeFi",
                                                "B": "FinTech builds better UX on existing financial rails, while Crypto/DeFi builds entirely new infrastructure",
                                                "C": "FinTech only works in developed countries",
                                                "D": "Crypto/DeFi has no transaction fees"
                                },
                                "correct": "B",
                                "explanation": "The fundamental fork in digital finance is philosophical: FinTech aims to improve the existing financial system with better technology and UX while using traditional rails (banks, payment networks). Crypto/DeFi aims to replace the system entirely with new trustless, decentralized infrastructure based on blockchain technology. Both address the same frictions but with different approaches.",
                                "difficulty": "easy"
                },
                {
                                "id": 3,
                                "question": "Which FinTech company category represents mobile-first digital banks with no physical branches?",
                                "options": {
                                                "A": "Payment processors",
                                                "B": "Neobanks",
                                                "C": "Robo-advisors",
                                                "D": "InsurTech"
                                },
                                "correct": "B",
                                "explanation": "Neobanks (like Chime, N26, Revolut, and Nubank) are digital-first banks that operate primarily or exclusively through mobile apps without physical branch networks. They still use traditional banking infrastructure and are licensed banks, but offer better user experience, lower fees, and modern features compared to traditional banks.",
                                "difficulty": "easy"
                },
                {
                                "id": 4,
                                "question": "What are the three main DeFi lending protocols mentioned in the course?",
                                "options": {
                                                "A": "PayPal, Venmo, and Cash App",
                                                "B": "Aave, Compound, and MakerDAO",
                                                "C": "Robinhood, Webull, and eToro",
                                                "D": "Stripe, Square, and Adyen"
                                },
                                "correct": "B",
                                "explanation": "Aave, Compound, and MakerDAO are the key DeFi lending protocols. They enable peer-to-peer lending through smart contracts without traditional intermediaries. Users can lend assets to earn interest or borrow by providing collateral, all executed automatically on blockchain with transparent interest rates determined by supply and demand.",
                                "difficulty": "easy"
                },
                {
                                "id": 5,
                                "question": "Which category best describes Stripe, Square, and Adyen?",
                                "options": {
                                                "A": "Neobanks",
                                                "B": "Payment processors and infrastructure providers",
                                                "C": "Robo-advisors",
                                                "D": "Crypto exchanges"
                                },
                                "correct": "B",
                                "explanation": "Stripe, Square, and Adyen are payment processors and infrastructure providers that enable businesses to accept payments. They provide APIs, point-of-sale systems, and payment gateways that connect merchants to existing payment networks (card networks, ACH, etc.). They represent the infrastructure layer of FinTech payments.",
                                "difficulty": "easy"
                },
                {
                                "id": 6,
                                "question": "What is Uniswap?",
                                "options": {
                                                "A": "A traditional stock exchange",
                                                "B": "A decentralized exchange (DEX) that uses automated market makers",
                                                "C": "A neobank focused on young professionals",
                                                "D": "A payment processing company"
                                },
                                "correct": "B",
                                "explanation": "Uniswap is a decentralized exchange (DEX) protocol built on Ethereum that allows users to trade tokens directly without a centralized intermediary. It uses an automated market maker (AMM) model where trades execute against liquidity pools rather than order books. Uniswap is one of the foundational DeFi protocols.",
                                "difficulty": "easy"
                },
                {
                                "id": 7,
                                "question": "According to the slides, what does the global financial system move daily?",
                                "options": {
                                                "A": "$960 million",
                                                "B": "$9.6 billion",
                                                "C": "$9.6 trillion",
                                                "D": "$96 trillion"
                                },
                                "correct": "C",
                                "explanation": "The global financial system moves approximately $9.6 trillion daily. This massive volume demonstrates the scale and complexity of traditional finance infrastructure, which serves billions of people and rarely fails catastrophically, despite having significant frictions that digital finance aims to address.",
                                "difficulty": "medium"
                },
                {
                                "id": 8,
                                "question": "What is the primary friction that payment sector innovations address?",
                                "options": {
                                                "A": "Investment returns",
                                                "B": "Speed, cost, and convenience of money movement",
                                                "C": "Insurance claims processing",
                                                "D": "Credit scoring accuracy"
                                },
                                "correct": "B",
                                "explanation": "Payment innovations primarily target speed, cost, and convenience frictions. Traditional payments are slow (3-5 days for international transfers), expensive (especially cross-border), and inconvenient (limited hours, geographic restrictions). Digital payment solutions like Venmo, Stripe, and USDC transfers aim to make payments faster, cheaper, and more accessible.",
                                "difficulty": "medium"
                },
                {
                                "id": 9,
                                "question": "What does BNPL stand for in the lending sector?",
                                "options": {
                                                "A": "Bank Network Payment Link",
                                                "B": "Buy Now Pay Later",
                                                "C": "Blockchain Network Public Ledger",
                                                "D": "Business Network Protocol Layer"
                                },
                                "correct": "B",
                                "explanation": "BNPL (Buy Now Pay Later) refers to lending products offered by companies like Affirm, Klarna, and Afterpay that allow consumers to split purchases into installment payments. BNPL has grown rapidly as a FinTech innovation that addresses access to short-term credit without traditional credit cards, particularly popular with younger consumers.",
                                "difficulty": "medium"
                },
                {
                                "id": 10,
                                "question": "Which FinTech companies are classified as robo-advisors?",
                                "options": {
                                                "A": "Chime and Revolut",
                                                "B": "Betterment and Wealthfront",
                                                "C": "Stripe and Square",
                                                "D": "LendingClub and Prosper"
                                },
                                "correct": "B",
                                "explanation": "Betterment and Wealthfront are robo-advisors - automated investment platforms that use algorithms to build and manage diversified portfolios. They address frictions in wealth management by lowering minimum investment requirements, reducing fees, and democratizing access to portfolio management strategies previously available only to high-net-worth individuals.",
                                "difficulty": "medium"
                },
                {
                                "id": 11,
                                "question": "What is the infrastructure layer that all digital finance applications build upon?",
                                "options": {
                                                "A": "Social media platforms",
                                                "B": "Blockchain, APIs, Data, and Identity systems",
                                                "C": "Retail stores and shopping malls",
                                                "D": "Television and radio networks"
                                },
                                "correct": "B",
                                "explanation": "The infrastructure layer includes: Blockchain (distributed ledgers), APIs (like Plaid for banking data), Data systems (oracles, credit bureaus, market data), and Identity (KYC systems, DIDs, ENS). All digital finance applications - whether FinTech or DeFi - build on top of these foundational components. Understanding the infrastructure helps understand what innovations are possible.",
                                "difficulty": "medium"
                },
                {
                                "id": 12,
                                "question": "What role does Plaid play in the FinTech ecosystem?",
                                "options": {
                                                "A": "It's a neobank competing with traditional banks",
                                                "B": "It's an API infrastructure provider that connects applications to users' bank accounts",
                                                "C": "It's a cryptocurrency exchange",
                                                "D": "It's a robo-advisor platform"
                                },
                                "correct": "B",
                                "explanation": "Plaid is an infrastructure provider that creates APIs connecting fintech applications to users' bank accounts. It enables services like Venmo, Robinhood, and others to verify bank accounts, check balances, and initiate transfers. Plaid represents the 'picks and shovels' of FinTech - enabling innovation by providing essential data connectivity.",
                                "difficulty": "medium"
                },
                {
                                "id": 13,
                                "question": "Which statement best describes the difference between centralized exchanges (CEX) and decentralized exchanges (DEX)?",
                                "options": {
                                                "A": "CEX are always free while DEX charge high fees",
                                                "B": "CEX operate through a company that holds user funds, while DEX enable peer-to-peer trading via smart contracts without a central intermediary",
                                                "C": "CEX only trade stocks while DEX only trade crypto",
                                                "D": "DEX require government licenses while CEX do not"
                                },
                                "correct": "B",
                                "explanation": "Centralized exchanges (like Coinbase, Binance) are companies that hold user funds and facilitate trades through an order book, similar to traditional exchanges. Decentralized exchanges (like Uniswap, Curve) use smart contracts to enable direct peer-to-peer trading without holding user funds - users trade directly from their wallets. This represents the core philosophical difference between FinTech and DeFi approaches.",
                                "difficulty": "medium"
                },
                {
                                "id": 14,
                                "question": "What is Banking-as-a-Service (BaaS)?",
                                "options": {
                                                "A": "A service where customers rent bank branches",
                                                "B": "Platforms that allow non-bank companies to offer banking services by connecting to licensed banks through APIs",
                                                "C": "A cryptocurrency mining service",
                                                "D": "A traditional bank's online portal"
                                },
                                "correct": "B",
                                "explanation": "Banking-as-a-Service (BaaS) platforms like Synapse, Unit, and Treasury Prime enable non-bank companies to offer banking features (accounts, cards, transfers) by providing API access to licensed banks. This unbundling allows fintech companies to integrate banking functionality without becoming licensed banks themselves, accelerating innovation in financial services.",
                                "difficulty": "medium"
                },
                {
                                "id": 15,
                                "question": "What do the InsurTech companies Lemonade, Root, and Oscar have in common?",
                                "options": {
                                                "A": "They use technology to reduce insurance costs, improve claims processing, and enhance user experience",
                                                "B": "They only offer cryptocurrency insurance",
                                                "C": "They are blockchain-based decentralized protocols",
                                                "D": "They exclusively serve business customers"
                                },
                                "correct": "A",
                                "explanation": "InsurTech companies like Lemonade, Root, and Oscar use technology to modernize insurance. They address insurance sector frictions including high costs, slow claims processing, opacity in pricing, and poor user experience. They use AI, mobile-first design, and data analytics while still operating within traditional insurance regulatory frameworks.",
                                "difficulty": "hard"
                },
                {
                                "id": 16,
                                "question": "What is the convergence trend described in the landscape overview?",
                                "options": {
                                                "A": "All financial companies are becoming exactly the same",
                                                "B": "FinTech companies are adding crypto features while crypto projects improve UX, blurring the lines between approaches",
                                                "C": "Traditional banks are completely disappearing",
                                                "D": "Cash is being eliminated worldwide"
                                },
                                "correct": "B",
                                "explanation": "The slides describe an increasingly blurred boundary where FinTech companies (like PayPal, Robinhood) add cryptocurrency features, while crypto projects work to improve user experience to match FinTech standards. Traditional banks are also exploring blockchain. Despite this convergence, the underlying philosophical differences between improving existing infrastructure versus building new infrastructure remain distinct.",
                                "difficulty": "hard"
                },
                {
                                "id": 17,
                                "question": "According to the slides, which of the following best represents the Crypto/DeFi philosophy?",
                                "options": {
                                                "A": "Work within existing infrastructure with better UX",
                                                "B": "Build new trustless, decentralized infrastructure to replace the existing system",
                                                "C": "Focus only on reducing transaction fees",
                                                "D": "Partner with traditional banks to improve their services"
                                },
                                "correct": "B",
                                "explanation": "The Crypto/DeFi philosophy is to build entirely new infrastructure based on trustless, decentralized principles. Rather than improving existing banks and payment networks, it aims to create an alternative financial system using blockchain, cryptography, and smart contracts that doesn't require trusting central authorities. This represents fundamental replacement rather than incremental improvement.",
                                "difficulty": "hard"
                },
                {
                                "id": 18,
                                "question": "What is a key advantage of FinTech over Crypto/DeFi mentioned in the slides?",
                                "options": {
                                                "A": "Complete censorship resistance",
                                                "B": "Regulatory compliance, consumer protections, and familiar user experience",
                                                "C": "Anonymous transactions for all users",
                                                "D": "Guaranteed profits for all investors"
                                },
                                "correct": "B",
                                "explanation": "FinTech's advantages include regulatory compliance (legal clarity), consumer protections (chargebacks, deposit insurance), familiar UX (polished interfaces), fiat integration, customer support, and proven business models. These come from working within the existing system. The trade-off is that FinTech solutions remain intermediated, can be censored, and have geographic restrictions.",
                                "difficulty": "hard"
                },
                {
                                "id": 19,
                                "question": "What does 'composability' or 'money legos' mean in the DeFi context?",
                                "options": {
                                                "A": "DeFi protocols can be built with children's toys",
                                                "B": "DeFi protocols can be combined and stacked together because they're open-source and interoperable",
                                                "C": "DeFi is only for playing games",
                                                "D": "Each DeFi protocol must operate in complete isolation"
                                },
                                "correct": "B",
                                "explanation": "Composability (or 'money legos') refers to DeFi protocols being open-source, interoperable building blocks that can be combined in novel ways. For example, you might use Uniswap to trade tokens, deposit them in Aave to earn interest, use that as collateral for a MakerDAO loan, and invest the proceeds in a Yearn vault - all in one transaction. This permissionless innovation is a key advantage of DeFi's open architecture.",
                                "difficulty": "hard"
                },
                {
                                "id": 20,
                                "question": "According to the landscape overview, what is the infrastructure that underpins both FinTech and Crypto/DeFi applications?",
                                "options": {
                                                "A": "Physical bank branches and ATM networks",
                                                "B": "Blockchain, APIs, Data systems, and Identity infrastructure",
                                                "C": "Social media advertising platforms",
                                                "D": "Traditional stock exchanges only"
                                },
                                "correct": "B",
                                "explanation": "The course emphasizes that all digital finance applications - whether FinTech or DeFi - build upon a shared infrastructure layer consisting of: Blockchain networks (Ethereum, Solana, Bitcoin), APIs (Plaid, Stripe, Open Banking), Data systems (oracles like Chainlink, credit bureaus, market data), and Identity systems (KYC/AML, decentralized identifiers, ENS). Understanding this infrastructure is key to understanding what innovations are technically possible and where the boundaries lie between different approaches.",
                                "difficulty": "hard"
                }
]
        };

        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            displayedQuestions: [],
            pendingSlots: []
        };

        const questionsRow = document.getElementById('questionsRow');
        const progressBar = document.getElementById('progressBar');
        const progressBadge = document.getElementById('progressBadge');
        const scoreBadge = document.getElementById('scoreBadge');
        const resultsCard = document.getElementById('resultsCard');
        const nextBtn = document.getElementById('nextBtn');

        function initQuiz() {
            state.currentIndex = 0;
            state.answers = {};
            state.score = 0;
            state.displayedQuestions = [];
            state.pendingSlots = [];

            resultsCard.classList.remove('show');
            questionsRow.style.display = 'grid';
            nextBtn.classList.remove('show');

            // Show first 3 questions
            for (let i = 0; i < 3 && i < quizData.questions.length; i++) {
                state.displayedQuestions.push(i);
            }
            state.currentIndex = Math.min(3, quizData.questions.length);

            renderQuestions();
            updateStats();
        }

        function renderQuestions() {
            questionsRow.innerHTML = '';

            state.displayedQuestions.forEach((qIdx, slot) => {
                const q = quizData.questions[qIdx];
                const answered = state.answers[q.id] !== undefined;
                const isCorrect = answered && state.answers[q.id] === q.correct;
                const isIncorrect = answered && state.answers[q.id] !== q.correct;

                const card = document.createElement('div');
                card.className = 'question-card';
                if (isCorrect) card.classList.add('correct-card', 'answered');
                if (isIncorrect) card.classList.add('incorrect-card', 'answered');

                card.innerHTML = `
                    <div class="q-header">
                        <span class="q-number">Q${qIdx + 1}</span>
                        ${answered ? `<span class="q-status">${isCorrect ? '&#10004;' : '&#10008;'}</span>` : ''}
                    </div>
                    <div class="q-text">${q.question}</div>
                    <div class="options" data-qid="${q.id}" data-slot="${slot}">
                        ${['A','B','C','D'].map(letter => {
                            let optClass = 'option-btn';
                            if (answered) {
                                optClass += ' disabled';
                                if (letter === q.correct) optClass += ' correct';
                                else if (letter === state.answers[q.id]) optClass += ' incorrect';
                            }
                            return `
                                <button class="${optClass}" data-letter="${letter}" ${answered ? 'disabled' : ''}>
                                    <span class="option-letter">${letter}</span>
                                    <span class="option-text">${q.options[letter]}</span>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    <div class="feedback ${answered ? 'show' : ''} ${isCorrect ? 'correct' : 'incorrect'}">
                        ${answered ? (isCorrect ? '&#10004; ' : `&#10008; Answer: ${q.correct}. `) + q.explanation : ''}
                    </div>
                `;

                // Add click handlers
                if (!answered) {
                    card.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => handleAnswer(qIdx, slot, btn.dataset.letter));
                    });
                }

                questionsRow.appendChild(card);
            });

            renderMath();
        }

        function handleAnswer(qIdx, slot, letter) {
            const q = quizData.questions[qIdx];
            state.answers[q.id] = letter;

            if (letter === q.correct) state.score++;

            // Track this slot as pending replacement
            if (!state.pendingSlots.includes(slot)) {
                state.pendingSlots.push(slot);
            }

            updateStats();
            renderQuestions();

            // Check if all questions answered
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                // Short delay then show results
                setTimeout(showResults, 800);
            } else if (state.currentIndex < quizData.questions.length && state.pendingSlots.length > 0) {
                // Show Next button if there are more questions and pending slots
                nextBtn.classList.add('show');
            }
        }

        function loadNextQuestions() {
            // Replace pending slots with new questions
            while (state.pendingSlots.length > 0 && state.currentIndex < quizData.questions.length) {
                const slot = state.pendingSlots.shift();
                state.displayedQuestions[slot] = state.currentIndex;
                state.currentIndex++;
            }

            // Hide Next button
            nextBtn.classList.remove('show');

            renderQuestions();

            // Check if quiz is complete (all displayed questions answered)
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                setTimeout(showResults, 500);
            }
        }

        function updateStats() {
            const answered = Object.keys(state.answers).length;
            const total = quizData.questions.length;

            progressBar.style.width = `${(answered / total) * 100}%`;
            progressBadge.textContent = `${answered}/${total}`;
            scoreBadge.textContent = `Score: ${state.score}`;
        }

        function showResults() {
            questionsRow.style.display = 'none';
            nextBtn.classList.remove('show');
            resultsCard.classList.add('show');

            const total = quizData.questions.length;
            const percentage = Math.round((state.score / total) * 100);

            document.getElementById('resultsScore').textContent = `${state.score}/${total}`;

            let grade, gradeClass, icon;
            if (percentage >= 90) { grade = 'Excellent! A'; gradeClass = 'grade-a'; icon = '&#127942;'; }
            else if (percentage >= 80) { grade = 'Great! B'; gradeClass = 'grade-b'; icon = '&#11088;'; }
            else if (percentage >= 70) { grade = 'Good! C'; gradeClass = 'grade-c'; icon = '&#128077;'; }
            else if (percentage >= 60) { grade = 'Pass - D'; gradeClass = 'grade-d'; icon = '&#128221;'; }
            else { grade = 'Keep practicing'; gradeClass = 'grade-f'; icon = '&#128218;'; }

            document.getElementById('resultsIcon').innerHTML = icon;
            const gradeEl = document.getElementById('resultsGrade');
            gradeEl.textContent = `${grade} (${percentage}%)`;
            gradeEl.className = `results-grade ${gradeClass}`;
        }

        function restartQuiz() {
            initQuiz();
        }

        function renderMath() {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initQuiz();
            setTimeout(renderMath, 100);
        });
    </script>
</body>
</html>
