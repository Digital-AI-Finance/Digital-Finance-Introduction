<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz 2: Payment Analysis | Digital Finance</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        :root {
            --mlpurple: #3333B2;
            --mlblue: #0066CC;
            --quiz-accent: #8b5cf6;
            --quiz-light: #ede9fe;
            --correct: #22c55e;
            --correct-bg: #dcfce7;
            --incorrect: #ef4444;
            --incorrect-bg: #fee2e2;
            --bg: #f6f8fa;
            --card-bg: #ffffff;
            --text: #24292e;
            --text-secondary: #586069;
            --border: #e1e4e8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
            min-height: 100vh;
        }

        .nav {
            background: linear-gradient(135deg, var(--mlpurple), var(--mlblue));
            color: white;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-title { font-weight: 600; font-size: 14px; }
        .nav-links { display: flex; gap: 16px; }
        .nav-links a { color: white; text-decoration: none; font-size: 12px; opacity: 0.9; }
        .nav-links a:hover { opacity: 1; }

        .quiz-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 0 4px;
        }
        .quiz-title { font-size: 16px; font-weight: 600; color: var(--mlpurple); }
        .quiz-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
        }
        .stat-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        .stat-progress { background: var(--quiz-light); color: var(--quiz-accent); }
        .stat-score { background: var(--correct-bg); color: var(--correct); }

        .progress-bar-container {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-bottom: 12px;
        }
        .progress-bar {
            height: 100%;
            background: var(--quiz-accent);
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Three-column layout */
        .questions-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 12px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            min-height: 280px;
        }

        .question-card.answered { opacity: 0.7; }

        .question-card.correct-card {
            border: 2px solid var(--correct);
            background: linear-gradient(to bottom, var(--correct-bg), var(--card-bg));
        }

        .question-card.incorrect-card {
            border: 2px solid var(--incorrect);
            background: linear-gradient(to bottom, var(--incorrect-bg), var(--card-bg));
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .q-number {
            background: var(--quiz-light);
            color: var(--quiz-accent);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .q-status { font-size: 14px; }

        .q-text {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-grow: 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-grow: 1;
        }

        .option-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            min-height: 44px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--card-bg);
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            font-size: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--quiz-accent);
            background: var(--quiz-light);
        }

        .option-btn.correct {
            border-color: var(--correct);
            background: var(--correct-bg);
        }

        .option-btn.incorrect {
            border-color: var(--incorrect);
            background: var(--incorrect-bg);
        }

        .option-btn.disabled { cursor: default; }

        .option-letter {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 10px;
            flex-shrink: 0;
        }

        .option-btn.correct .option-letter {
            background: var(--correct);
            color: white;
        }

        .option-btn.incorrect .option-letter {
            background: var(--incorrect);
            color: white;
        }

        .option-text { flex: 1; }

        .feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            line-height: 1.4;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: var(--correct-bg); color: #166534; }
        .feedback.incorrect { background: var(--incorrect-bg); color: #991b1b; }

        /* Results */
        .results-card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 32px;
            text-align: center;
            max-width: 500px;
            margin: 40px auto;
            display: none;
        }
        .results-card.show { display: block; }
        .results-icon { font-size: 48px; margin-bottom: 8px; }
        .results-score { font-size: 36px; font-weight: 700; color: var(--quiz-accent); }
        .results-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
        .results-grade {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .grade-a { background: #dcfce7; color: #166534; }
        .grade-b { background: #dbeafe; color: #1e40af; }
        .grade-c { background: #fef3c7; color: #92400e; }
        .grade-d { background: #fed7aa; color: #9a3412; }
        .grade-f { background: #fee2e2; color: #991b1b; }

        .results-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        .btn-primary { background: var(--quiz-accent); color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-secondary { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }

        /* Next button container */
        .next-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }
        .btn-next {
            padding: 10px 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: var(--quiz-accent);
            color: white;
            transition: all 0.2s;
            display: none;
        }
        .btn-next:hover { background: #7c3aed; transform: scale(1.02); }
        .btn-next.show { display: inline-block; }
        .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }

        @media (max-width: 900px) {
            .questions-row { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .questions-row { grid-template-columns: 1fr; }
            .question-card { min-height: auto; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-title">Quiz 2: Payment Analysis</div>
        <div class="nav-links">
            <a href="../index.html">Dashboard</a>
            
            <a href="https://github.com/Digital-AI-Finance/Digital-Finance-Introduction" target="_blank">GitHub</a>
        </div>
    </nav>

    <main class="quiz-container">
        <div class="quiz-header">
            <div class="quiz-title">Quiz 2: Payment Analysis</div>
            <div class="quiz-stats">
                <span class="stat-badge stat-progress" id="progressBadge">0/20</span>
                <span class="stat-badge stat-score" id="scoreBadge">Score: 0</span>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="questions-row" id="questionsRow"></div>

        <div class="next-btn-container">
            <button class="btn-next" id="nextBtn" onclick="loadNextQuestions()">Next</button>
        </div>

        <div class="results-card" id="resultsCard">
            <div class="results-icon" id="resultsIcon"></div>
            <div class="results-score" id="resultsScore"></div>
            <div class="results-label">Correct Answers</div>
            <div class="results-grade" id="resultsGrade"></div>
            <div class="results-buttons">
                <button class="btn btn-primary" onclick="restartQuiz()">Try Again</button>
                <a href="../index.html" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>
    </main>

    <script>
        const quizData = {
            questions: [
                {
                                "id": 1,
                                "question": "What are the six payment methods analyzed in the NB02 Payment Analysis notebook?",
                                "options": {
                                                "A": "Wire Transfer, ACH, SEPA, Check, Cash, Bitcoin",
                                                "B": "Wire Transfer, ACH, Credit Card, Debit Card, Digital Wallet, Cryptocurrency",
                                                "C": "SWIFT, FedWire, PayPal, Venmo, Cash App, Stripe",
                                                "D": "RTGS, DNS, Credit Card, Prepaid Card, Money Order, Check"
                                },
                                "correct": "B",
                                "explanation": "The notebook analyzes six payment methods: Wire Transfer (traditional bank-to-bank transfers with higher fees), ACH (Automated Clearing House batch processing), Credit Card (instant with merchant fees), Debit Card (direct bank account access with lower fees), Digital Wallet (services like PayPal/Venmo), and Cryptocurrency (blockchain-based transfers). Each has distinct characteristics in terms of speed, cost, and settlement time."
                },
                {
                                "id": 2,
                                "question": "Based on the fee structure analysis, which payment method is most cost-effective for small transactions under $500?",
                                "options": {
                                                "A": "Wire Transfer",
                                                "B": "Credit Card",
                                                "C": "ACH (Automated Clearing House)",
                                                "D": "Digital Wallet"
                                },
                                "correct": "C",
                                "explanation": "ACH is the most cost-effective for small transactions because it has a very low percentage fee (0.1%) and minimal fixed fee ($0.50). Wire transfers have a high fixed fee ($25) making them expensive for small amounts. Credit cards charge 2.5% plus $0.30, and digital wallets charge 2.9% plus $0.30. ACH's low fee structure makes it ideal for transactions under $500."
                },
                {
                                "id": 3,
                                "question": "What is the typical settlement time range for Wire Transfer transactions according to the notebook?",
                                "options": {
                                                "A": "0-1 hours (instant)",
                                                "B": "1-3 days",
                                                "C": "5-7 days",
                                                "D": "30 days"
                                },
                                "correct": "B",
                                "explanation": "Wire transfers typically settle in 1-3 days. While faster than historical methods, they are not instant. Digital wallets settle in 0-1 hours (often instantly), credit and debit cards settle in 0-1 days, and ACH also takes 1-3 days. Settlement time is crucial for liquidity management and working capital planning."
                },
                {
                                "id": 4,
                                "question": "What is the effective fee rate for Credit Card transactions in the payment system simulation?",
                                "options": {
                                                "A": "0.5% fixed rate",
                                                "B": "2.5% percentage fee plus $0.30 fixed fee",
                                                "C": "1% percentage fee plus $25 fixed fee",
                                                "D": "2.9% percentage fee with no fixed fee"
                                },
                                "correct": "B",
                                "explanation": "Credit cards in the simulation charge 2.5% of the transaction amount plus a $0.30 fixed fee. This blended fee structure is typical for card payments - combining a percentage (to capture value from larger transactions) with a fixed amount (to cover processing overhead). This makes credit cards expensive for merchants, especially on larger transactions."
                },
                {
                                "id": 5,
                                "question": "What is the primary purpose of visualizing payment networks as graphs in the notebook?",
                                "options": {
                                                "A": "To make the data look more attractive for presentations",
                                                "B": "To identify key players (hubs), detect fraud patterns, understand money flow, and assess systemic risks from interconnections",
                                                "C": "To calculate the exact settlement time for each transaction",
                                                "D": "To determine the optimal exchange rate for international transfers"
                                },
                                "correct": "B",
                                "explanation": "Payment network visualization serves critical analytical purposes: identifying major hubs (parties with many connections), detecting fraud (unusual network patterns), understanding money flow concentrations, and assessing systemic risk from interconnections. Network analysis can reveal business ecosystems, supply chains, or potential fraud rings through clustering and centrality measures."
                },
                {
                                "id": 6,
                                "question": "In network analysis, what does 'degree centrality' measure in a payment network?",
                                "options": {
                                                "A": "The total dollar value flowing through a party",
                                                "B": "How quickly payments settle for that party",
                                                "C": "The number of direct connections (other parties) a node has in the network",
                                                "D": "The credit rating of the party"
                                },
                                "correct": "C",
                                "explanation": "Degree centrality measures the number of direct connections a node has - essentially counting how many other parties a given party transacts with. High degree centrality indicates a party is highly active in the network. This is different from betweenness centrality (measuring how often a node lies on paths between other nodes) or PageRank (measuring importance based on who connects to you)."
                },
                {
                                "id": 7,
                                "question": "What is 'betweenness centrality' and why is it important in payment network analysis?",
                                "options": {
                                                "A": "It measures the average transaction amount for a party",
                                                "B": "It identifies parties that act as bridges between different groups, making them critical for network connectivity",
                                                "C": "It calculates the total fees earned by payment processors",
                                                "D": "It determines the fastest route for payment settlement"
                                },
                                "correct": "B",
                                "explanation": "Betweenness centrality identifies nodes that frequently appear on the shortest paths between other nodes - essentially acting as bridges or intermediaries. High betweenness centrality indicates a party that connects otherwise separate groups. These parties are critical for network connectivity but also represent potential bottlenecks or systemic risks. They may be correspondent banks, payment processors, or major distributors."
                },
                {
                                "id": 8,
                                "question": "Why do Wire Transfers have the highest fixed fee ($25) among the payment methods analyzed?",
                                "options": {
                                                "A": "Because they are the fastest payment method available",
                                                "B": "Because they involve manual processing, compliance checks (AML/KYC), SWIFT network fees, and correspondent banking overhead",
                                                "C": "Because governments require high fees to track large transactions",
                                                "D": "Because wire transfers can only be used for international payments"
                                },
                                "correct": "B",
                                "explanation": "Wire transfers have high fixed fees ($25+) due to multiple cost factors: manual processing by bank staff, mandatory compliance checks (Anti-Money Laundering and Know Your Customer requirements), SWIFT network messaging fees, and correspondent banking relationships that each take a cut. Unlike automated systems like ACH, wire transfers often require human verification and multiple intermediaries, especially for international transfers."
                },
                {
                                "id": 9,
                                "question": "What pattern does the notebook reveal about transaction frequency throughout the day?",
                                "options": {
                                                "A": "Transactions are evenly distributed across all 24 hours",
                                                "B": "Most transactions occur during late night hours (midnight to 6 AM)",
                                                "C": "Transactions show a bias toward business hours (8 AM to 6 PM)",
                                                "D": "Transaction frequency is highest during weekends"
                                },
                                "correct": "C",
                                "explanation": "The notebook's synthetic data is generated with a business hours bias (8 AM to 6 PM), reflecting real-world patterns where most commercial and consumer transactions occur during waking business hours. This pattern is important for capacity planning (servers must handle peak loads), fraud detection (unusual hour transactions may be suspicious), and liquidity management (banks need funds available during high-activity periods)."
                },
                {
                                "id": 10,
                                "question": "What is the purpose of calculating percentiles (P50, P75, P90, P95, P99) for settlement times?",
                                "options": {
                                                "A": "To determine the average transaction amount",
                                                "B": "To understand Service Level Agreement (SLA) compliance and set customer expectations for settlement timing",
                                                "C": "To calculate total fee revenue for payment processors",
                                                "D": "To identify which payment method is most popular"
                                },
                                "correct": "B",
                                "explanation": "Settlement time percentiles are critical for SLA design and customer expectations. P50 (median) shows typical experience, P90-P95 show what 'most' customers experience, and P99 captures worst-case scenarios. For example, if P95 for ACH is 72 hours, a business can promise '95% of ACH payments settle within 3 days' in their SLA. This helps manage customer expectations and identify outliers that need investigation."
                },
                {
                                "id": 11,
                                "question": "In the fee comparison analysis, at what approximate transaction size do wire transfers become more cost-effective than other methods?",
                                "options": {
                                                "A": "They are never cost-effective due to the high fixed fee",
                                                "B": "Around $100",
                                                "C": "Around $5,000-$10,000 and above",
                                                "D": "Around $50"
                                },
                                "correct": "A",
                                "explanation": "According to the notebook's analysis, wire transfers are generally not the most cost-effective choice at any transaction size due to their high fixed fee ($25) and percentage fee (0.5%). ACH remains cheaper even for large transactions. Wire transfers are used not for cost efficiency but for speed, certainty, and regulatory requirements in certain contexts (like real estate transactions). The high fee is the cost of the manual processing, compliance, and guaranteed settlement."
                },
                {
                                "id": 12,
                                "question": "What does the notebook identify as the four key business intelligence uses of payment volume analysis?",
                                "options": {
                                                "A": "Marketing, Sales, HR, and Legal compliance",
                                                "B": "Capacity Planning, Fraud Detection, Business Intelligence, and Revenue Forecasting",
                                                "C": "Customer Acquisition, Retention, Expansion, and Churn Analysis",
                                                "D": "Product Development, Pricing Strategy, Distribution, and Promotion"
                                },
                                "correct": "B",
                                "explanation": "The notebook emphasizes four critical uses of payment volume analysis: (1) Capacity Planning - ensuring systems can handle peak loads; (2) Fraud Detection - identifying unusual patterns that may indicate fraud; (3) Business Intelligence - understanding customer behavior and transaction patterns; (4) Revenue Forecasting - predicting fee income based on volume trends. These insights drive operational and strategic decisions."
                },
                {
                                "id": 13,
                                "question": "What is the transaction status distribution simulated in the dataset, and why does it matter?",
                                "options": {
                                                "A": "100% completed - all transactions succeed",
                                                "B": "92% completed, 5% pending, 3% failed - reflecting real-world failure rates for operational planning",
                                                "C": "50% completed, 50% failed - to test error handling",
                                                "D": "80% completed, 20% cancelled by users"
                                },
                                "correct": "B",
                                "explanation": "The simulation uses realistic distributions: 92% completed, 5% pending, 3% failed. This matters because: (1) failure rates affect revenue projections (failed transactions don't generate fees), (2) pending transactions require liquidity reserves, (3) high failure rates may indicate system issues or fraud, (4) customer satisfaction depends on successful transaction completion. Understanding and managing these rates is critical for payment system operations."
                },
                {
                                "id": 14,
                                "question": "Why does the notebook use a log-normal distribution to generate transaction amounts?",
                                "options": {
                                                "A": "Because all transactions are exactly the same amount",
                                                "B": "Because transaction amounts in real financial data tend to be right-skewed with many small transactions and few large ones",
                                                "C": "Because regulators require payments to follow this distribution",
                                                "D": "Because it makes calculations easier"
                                },
                                "correct": "B",
                                "explanation": "Log-normal distributions model real-world transaction patterns where most transactions are small (many people buy coffee, groceries, etc.) but a few transactions are very large (business purchases, real estate, etc.). This creates a right-skewed distribution with a long tail. Using log-normal makes the synthetic data realistic, which is important for accurate analysis of percentiles, outlier detection, and fee revenue calculations."
                },
                {
                                "id": 15,
                                "question": "What does 'settlement time' mean in the context of payment systems?",
                                "options": {
                                                "A": "The time it takes to type in payment information",
                                                "B": "The period between when a payment is initiated and when funds are actually, irrevocably transferred and available to the recipient",
                                                "C": "The time it takes to print a receipt",
                                                "D": "The amount of time a customer has to dispute a charge"
                                },
                                "correct": "B",
                                "explanation": "Settlement time is the critical period from payment initiation to final, irrevocable transfer of funds. This matters immensely for: liquidity management (businesses need to know when funds will be available), working capital (cash flow planning), customer experience (faster is better), and regulatory compliance (some regulations mandate specific settlement windows). 'Instant' settlement (like digital wallets) versus 1-3 day settlement (like ACH) has major business implications."
                },
                {
                                "id": 16,
                                "question": "According to the fee analysis, which payment method has the highest effective fee rate as a percentage of transaction volume?",
                                "options": {
                                                "A": "ACH at 0.1%",
                                                "B": "Wire Transfer at 0.5%",
                                                "C": "Digital Wallet at 2.9%",
                                                "D": "Debit Card at 1.5%"
                                },
                                "correct": "C",
                                "explanation": "Digital wallets have the highest percentage fee at 2.9% (plus $0.30 fixed fee), followed by credit cards at 2.5%. This high fee covers the cost of instant settlement, fraud protection, dispute resolution, and platform maintenance. ACH is cheapest at 0.1%, wire transfers are 0.5%, and debit cards are 1.5%. The trade-off is speed and convenience versus cost - digital wallets are instant but expensive."
                },
                {
                                "id": 17,
                                "question": "What is PageRank in the context of payment network analysis?",
                                "options": {
                                                "A": "The number of payments a party sends",
                                                "B": "A measure of importance based on who connects to you - parties receiving payments from important parties score higher",
                                                "C": "The average size of transactions",
                                                "D": "The speed at which payments are processed"
                                },
                                "correct": "B",
                                "explanation": "PageRank (originally from Google's search algorithm) measures importance based on the quality and quantity of incoming connections. In payment networks, a party with high PageRank receives payments from other important parties. This identifies influential nodes differently than simple transaction count - it's not just how many connections you have, but who those connections are. High PageRank may indicate trusted vendors, major suppliers, or critical service providers."
                },
                {
                                "id": 18,
                                "question": "Why does the notebook analyze both transaction count share AND volume share separately for payment methods?",
                                "options": {
                                                "A": "Because they always show identical patterns",
                                                "B": "Because transaction count shows usage frequency while volume reveals where money actually flows - a method could have many small transactions (high count) but low total value (low volume)",
                                                "C": "Because regulators require both metrics",
                                                "D": "Because one metric is for customers and one is for merchants"
                                },
                                "correct": "B",
                                "explanation": "Transaction count and volume tell different stories. A payment method might handle 30% of transactions (high count share) but only 10% of dollar volume (low volume share) - indicating it's used for small payments. Conversely, wire transfers might be 5% of transaction count but 40% of volume - few transactions but large amounts. Both metrics matter: count affects system capacity planning, while volume drives revenue and risk exposure."
                },
                {
                                "id": 19,
                                "question": "What does the 'net flow' metric reveal about a party in the payment network?",
                                "options": {
                                                "A": "How fast they process transactions",
                                                "B": "Whether they are primarily a recipient (positive net flow) or sender (negative net flow) of funds in the network",
                                                "C": "Their credit score",
                                                "D": "Which payment method they prefer"
                                },
                                "correct": "B",
                                "explanation": "Net flow = incoming_value - outgoing_value. Positive net flow indicates a party receives more than they send (like a retailer or service provider collecting revenue). Negative net flow indicates a party sends more than receives (like a customer or buyer). Understanding net flows helps identify business roles, concentration of funds, liquidity needs, and potential systemic risks in the payment network."
                },
                {
                                "id": 20,
                                "question": "What are the three main applications of payment analysis highlighted in the notebook's real-world applications section?",
                                "options": {
                                                "A": "Marketing, Sales, and Customer Service",
                                                "B": "Fraud Detection, Liquidity Management, and Cost Optimization",
                                                "C": "Product Development, Pricing, and Distribution",
                                                "D": "Hiring, Training, and Performance Management"
                                },
                                "correct": "B",
                                "explanation": "The notebook emphasizes three critical real-world applications: (1) Fraud Detection - identifying unusual patterns and network anomalies that may indicate fraudulent activity; (2) Liquidity Management - predicting settlement times and managing working capital based on when funds will be available; (3) Cost Optimization - selecting the right payment method for each transaction size to minimize fees. These directly impact profitability, risk management, and operational efficiency."
                }
]
        };

        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            displayedQuestions: [],
            pendingSlots: []
        };

        const questionsRow = document.getElementById('questionsRow');
        const progressBar = document.getElementById('progressBar');
        const progressBadge = document.getElementById('progressBadge');
        const scoreBadge = document.getElementById('scoreBadge');
        const resultsCard = document.getElementById('resultsCard');
        const nextBtn = document.getElementById('nextBtn');

        function initQuiz() {
            state.currentIndex = 0;
            state.answers = {};
            state.score = 0;
            state.displayedQuestions = [];
            state.pendingSlots = [];

            resultsCard.classList.remove('show');
            questionsRow.style.display = 'grid';
            nextBtn.classList.remove('show');

            // Show first 3 questions
            for (let i = 0; i < 3 && i < quizData.questions.length; i++) {
                state.displayedQuestions.push(i);
            }
            state.currentIndex = Math.min(3, quizData.questions.length);

            renderQuestions();
            updateStats();
        }

        function renderQuestions() {
            questionsRow.innerHTML = '';

            state.displayedQuestions.forEach((qIdx, slot) => {
                const q = quizData.questions[qIdx];
                const answered = state.answers[q.id] !== undefined;
                const isCorrect = answered && state.answers[q.id] === q.correct;
                const isIncorrect = answered && state.answers[q.id] !== q.correct;

                const card = document.createElement('div');
                card.className = 'question-card';
                if (isCorrect) card.classList.add('correct-card', 'answered');
                if (isIncorrect) card.classList.add('incorrect-card', 'answered');

                card.innerHTML = `
                    <div class="q-header">
                        <span class="q-number">Q${qIdx + 1}</span>
                        ${answered ? `<span class="q-status">${isCorrect ? '&#10004;' : '&#10008;'}</span>` : ''}
                    </div>
                    <div class="q-text">${q.question}</div>
                    <div class="options" data-qid="${q.id}" data-slot="${slot}">
                        ${['A','B','C','D'].map(letter => {
                            let optClass = 'option-btn';
                            if (answered) {
                                optClass += ' disabled';
                                if (letter === q.correct) optClass += ' correct';
                                else if (letter === state.answers[q.id]) optClass += ' incorrect';
                            }
                            return `
                                <button class="${optClass}" data-letter="${letter}" ${answered ? 'disabled' : ''}>
                                    <span class="option-letter">${letter}</span>
                                    <span class="option-text">${q.options[letter]}</span>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    <div class="feedback ${answered ? 'show' : ''} ${isCorrect ? 'correct' : 'incorrect'}">
                        ${answered ? (isCorrect ? '&#10004; ' : `&#10008; Answer: ${q.correct}. `) + q.explanation : ''}
                    </div>
                `;

                // Add click handlers
                if (!answered) {
                    card.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => handleAnswer(qIdx, slot, btn.dataset.letter));
                    });
                }

                questionsRow.appendChild(card);
            });

            renderMath();
        }

        function handleAnswer(qIdx, slot, letter) {
            const q = quizData.questions[qIdx];
            state.answers[q.id] = letter;

            if (letter === q.correct) state.score++;

            // Track this slot as pending replacement
            if (!state.pendingSlots.includes(slot)) {
                state.pendingSlots.push(slot);
            }

            updateStats();
            renderQuestions();

            // Check if all questions answered
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                // Short delay then show results
                setTimeout(showResults, 800);
            } else if (state.currentIndex < quizData.questions.length && state.pendingSlots.length > 0) {
                // Show Next button if there are more questions and pending slots
                nextBtn.classList.add('show');
            }
        }

        function loadNextQuestions() {
            // Replace pending slots with new questions
            while (state.pendingSlots.length > 0 && state.currentIndex < quizData.questions.length) {
                const slot = state.pendingSlots.shift();
                state.displayedQuestions[slot] = state.currentIndex;
                state.currentIndex++;
            }

            // Hide Next button
            nextBtn.classList.remove('show');

            renderQuestions();

            // Check if quiz is complete (all displayed questions answered)
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                setTimeout(showResults, 500);
            }
        }

        function updateStats() {
            const answered = Object.keys(state.answers).length;
            const total = quizData.questions.length;

            progressBar.style.width = `${(answered / total) * 100}%`;
            progressBadge.textContent = `${answered}/${total}`;
            scoreBadge.textContent = `Score: ${state.score}`;
        }

        function showResults() {
            questionsRow.style.display = 'none';
            nextBtn.classList.remove('show');
            resultsCard.classList.add('show');

            const total = quizData.questions.length;
            const percentage = Math.round((state.score / total) * 100);

            document.getElementById('resultsScore').textContent = `${state.score}/${total}`;

            let grade, gradeClass, icon;
            if (percentage >= 90) { grade = 'Excellent! A'; gradeClass = 'grade-a'; icon = '&#127942;'; }
            else if (percentage >= 80) { grade = 'Great! B'; gradeClass = 'grade-b'; icon = '&#11088;'; }
            else if (percentage >= 70) { grade = 'Good! C'; gradeClass = 'grade-c'; icon = '&#128077;'; }
            else if (percentage >= 60) { grade = 'Pass - D'; gradeClass = 'grade-d'; icon = '&#128221;'; }
            else { grade = 'Keep practicing'; gradeClass = 'grade-f'; icon = '&#128218;'; }

            document.getElementById('resultsIcon').innerHTML = icon;
            const gradeEl = document.getElementById('resultsGrade');
            gradeEl.textContent = `${grade} (${percentage}%)`;
            gradeEl.className = `results-grade ${gradeClass}`;
        }

        function restartQuiz() {
            initQuiz();
        }

        function renderMath() {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initQuiz();
            setTimeout(renderMath, 100);
        });
    </script>
</body>
</html>
