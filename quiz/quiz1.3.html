<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz 1.3: Fintech Vs Crypto Defi | Introduction to Digital Finance</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        :root {
            --mlpurple: #3333B2;
            --mlblue: #0066CC;
            --quiz-accent: #8b5cf6;
            --quiz-light: #ede9fe;
            --correct: #22c55e;
            --correct-bg: #dcfce7;
            --incorrect: #ef4444;
            --incorrect-bg: #fee2e2;
            --bg: #f6f8fa;
            --card-bg: #ffffff;
            --text: #24292e;
            --text-secondary: #586069;
            --border: #e1e4e8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
            min-height: 100vh;
        }

        .nav {
            background: linear-gradient(135deg, var(--mlpurple), var(--mlblue));
            color: white;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-title { font-weight: 600; font-size: 14px; }
        .nav-links { display: flex; gap: 16px; }
        .nav-links a { color: white; text-decoration: none; font-size: 12px; opacity: 0.9; }
        .nav-links a:hover { opacity: 1; }

        .quiz-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 0 4px;
        }
        .quiz-title { font-size: 16px; font-weight: 600; color: var(--mlpurple); }
        .quiz-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
        }
        .stat-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        .stat-progress { background: var(--quiz-light); color: var(--quiz-accent); }
        .stat-score { background: var(--correct-bg); color: var(--correct); }

        .progress-bar-container {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-bottom: 12px;
        }
        .progress-bar {
            height: 100%;
            background: var(--quiz-accent);
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Three-column layout */
        .questions-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 12px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            min-height: 280px;
        }

        .question-card.answered { opacity: 0.7; }

        .question-card.correct-card {
            border: 2px solid var(--correct);
            background: linear-gradient(to bottom, var(--correct-bg), var(--card-bg));
        }

        .question-card.incorrect-card {
            border: 2px solid var(--incorrect);
            background: linear-gradient(to bottom, var(--incorrect-bg), var(--card-bg));
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .q-number {
            background: var(--quiz-light);
            color: var(--quiz-accent);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .q-status { font-size: 14px; }

        .q-text {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-grow: 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-grow: 1;
        }

        .option-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            min-height: 44px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--card-bg);
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            font-size: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--quiz-accent);
            background: var(--quiz-light);
        }

        .option-btn.correct {
            border-color: var(--correct);
            background: var(--correct-bg);
        }

        .option-btn.incorrect {
            border-color: var(--incorrect);
            background: var(--incorrect-bg);
        }

        .option-btn.disabled { cursor: default; }

        .option-letter {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 10px;
            flex-shrink: 0;
        }

        .option-btn.correct .option-letter {
            background: var(--correct);
            color: white;
        }

        .option-btn.incorrect .option-letter {
            background: var(--incorrect);
            color: white;
        }

        .option-text { flex: 1; }

        .feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            line-height: 1.4;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: var(--correct-bg); color: #166534; }
        .feedback.incorrect { background: var(--incorrect-bg); color: #991b1b; }

        /* Results */
        .results-card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 32px;
            text-align: center;
            max-width: 500px;
            margin: 40px auto;
            display: none;
        }
        .results-card.show { display: block; }
        .results-icon { font-size: 48px; margin-bottom: 8px; }
        .results-score { font-size: 36px; font-weight: 700; color: var(--quiz-accent); }
        .results-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
        .results-grade {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .grade-a { background: #dcfce7; color: #166534; }
        .grade-b { background: #dbeafe; color: #1e40af; }
        .grade-c { background: #fef3c7; color: #92400e; }
        .grade-d { background: #fed7aa; color: #9a3412; }
        .grade-f { background: #fee2e2; color: #991b1b; }

        .results-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        .btn-primary { background: var(--quiz-accent); color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-secondary { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }

        /* Next button container */
        .next-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }
        .btn-next {
            padding: 10px 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: var(--quiz-accent);
            color: white;
            transition: all 0.2s;
            display: none;
        }
        .btn-next:hover { background: #7c3aed; transform: scale(1.02); }
        .btn-next.show { display: inline-block; }
        .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }

        @media (max-width: 900px) {
            .questions-row { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .questions-row { grid-template-columns: 1fr; }
            .question-card { min-height: auto; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-title">Quiz 1.3: Fintech Vs Crypto Defi</div>
        <div class="nav-links">
            <a href="../index.html">Dashboard</a>
            
            <a href="https://github.com/Digital-AI-Finance/Digital-Finance-Introduction" target="_blank">GitHub</a>
        </div>
    </nav>

    <main class="quiz-container">
        <div class="quiz-header">
            <div class="quiz-title">Quiz 1.3: Fintech Vs Crypto Defi</div>
            <div class="quiz-stats">
                <span class="stat-badge stat-progress" id="progressBadge">0/20</span>
                <span class="stat-badge stat-score" id="scoreBadge">Score: 0</span>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="questions-row" id="questionsRow"></div>

        <div class="next-btn-container">
            <button class="btn-next" id="nextBtn" onclick="loadNextQuestions()">Next</button>
        </div>

        <div class="results-card" id="resultsCard">
            <div class="results-icon" id="resultsIcon"></div>
            <div class="results-score" id="resultsScore"></div>
            <div class="results-label">Correct Answers</div>
            <div class="results-grade" id="resultsGrade"></div>
            <div class="results-buttons">
                <button class="btn btn-primary" onclick="restartQuiz()">Try Again</button>
                <a href="../index.html" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>
    </main>

    <script>
        const quizData = {
            questions: [
                {
                                "id": 1,
                                "difficulty": "easy",
                                "question": "What is the core philosophy of FinTech?",
                                "options": {
                                                "A": "Replace the existing financial system with blockchain",
                                                "B": "Improve the existing financial system with better UX and technology",
                                                "C": "Eliminate all financial intermediaries",
                                                "D": "Create permissionless financial infrastructure"
                                },
                                "correct": "B",
                                "explanation": "FinTech's core belief is that the existing financial infrastructure works but needs better user interfaces, more efficient processes, and smarter technology. It builds on top of existing rails rather than replacing them."
                },
                {
                                "id": 2,
                                "difficulty": "easy",
                                "question": "What is the core philosophy of Crypto/DeFi?",
                                "options": {
                                                "A": "Work within existing regulatory frameworks",
                                                "B": "Partner with traditional banks for innovation",
                                                "C": "Build new trustless, decentralized infrastructure",
                                                "D": "Focus primarily on improving user interfaces"
                                },
                                "correct": "C",
                                "explanation": "Crypto/DeFi believes the existing infrastructure is fundamentally flawed and needs to be replaced with new trust models based on cryptography, decentralization, programmable money, and permissionless access."
                },
                {
                                "id": 3,
                                "difficulty": "medium",
                                "question": "Which trust model does FinTech primarily rely on?",
                                "options": {
                                                "A": "Cryptographic proof and consensus mechanisms",
                                                "B": "Institutional trust in banks and regulators",
                                                "C": "Distributed ledger validation",
                                                "D": "Smart contract execution"
                                },
                                "correct": "B",
                                "explanation": "FinTech relies on institutional trust—trusting banks, payment networks, and regulatory frameworks. Crypto/DeFi, in contrast, uses code and mathematics as the basis for trust."
                },
                {
                                "id": 4,
                                "difficulty": "medium",
                                "question": "What is the permission model for Crypto/DeFi systems?",
                                "options": {
                                                "A": "Permissioned—requires KYC and regulatory approval",
                                                "B": "Permissionless—anyone can participate without approval",
                                                "C": "Semi-permissioned—requires partial verification",
                                                "D": "Centrally controlled with selective access"
                                },
                                "correct": "B",
                                "explanation": "Crypto/DeFi systems are permissionless, meaning anyone can participate without requiring approval from a central authority. FinTech systems typically require KYC and regulatory compliance."
                },
                {
                                "id": 5,
                                "difficulty": "easy",
                                "question": "Which of the following is a FinTech example?",
                                "options": {
                                                "A": "Uniswap",
                                                "B": "Aave",
                                                "C": "Venmo",
                                                "D": "MakerDAO"
                                },
                                "correct": "C",
                                "explanation": "Venmo is a FinTech payment app that operates on traditional ACH and banking rails. Uniswap, Aave, and MakerDAO are all DeFi protocols running on blockchain infrastructure."
                },
                {
                                "id": 6,
                                "difficulty": "easy",
                                "question": "Which of the following is a Crypto/DeFi example?",
                                "options": {
                                                "A": "Stripe",
                                                "B": "Chime",
                                                "C": "Compound",
                                                "D": "Affirm"
                                },
                                "correct": "C",
                                "explanation": "Compound is a DeFi lending protocol that uses smart contracts. Stripe, Chime, and Affirm are all FinTech companies that operate on traditional financial infrastructure."
                },
                {
                                "id": 7,
                                "difficulty": "medium",
                                "question": "What is the typical regulatory clarity situation for FinTech vs. Crypto/DeFi?",
                                "options": {
                                                "A": "Both have equal regulatory clarity",
                                                "B": "FinTech has higher regulatory clarity; Crypto/DeFi has lower",
                                                "C": "Crypto/DeFi has higher regulatory clarity; FinTech has lower",
                                                "D": "Neither has any regulatory oversight"
                                },
                                "correct": "B",
                                "explanation": "FinTech operates within established regulatory frameworks and has higher clarity. Crypto/DeFi faces regulatory uncertainty due to its novel nature and challenges to existing regulatory categories."
                },
                {
                                "id": 8,
                                "difficulty": "hard",
                                "question": "Which advantage does FinTech have over Crypto/DeFi?",
                                "options": {
                                                "A": "Censorship resistance",
                                                "B": "Permissionless access",
                                                "C": "Consumer protections and chargebacks",
                                                "D": "24/7 global operation"
                                },
                                "correct": "C",
                                "explanation": "FinTech offers consumer protections like chargebacks, regulatory oversight, and customer support. Crypto/DeFi has advantages in censorship resistance, permissionless access, and 24/7 operation, but lacks traditional consumer protections."
                },
                {
                                "id": 9,
                                "difficulty": "hard",
                                "question": "Which advantage does Crypto/DeFi have over FinTech?",
                                "options": {
                                                "A": "Familiar user experience",
                                                "B": "Regulatory compliance certainty",
                                                "C": "Composability and programmable money",
                                                "D": "Customer support services"
                                },
                                "correct": "C",
                                "explanation": "Crypto/DeFi enables composability ('money legos') and programmable money through smart contracts. FinTech has advantages in UX, regulatory clarity, and customer support, but lacks the programmability of smart contracts."
                },
                {
                                "id": 10,
                                "difficulty": "medium",
                                "question": "What is the identity verification difference between FinTech and Crypto/DeFi?",
                                "options": {
                                                "A": "FinTech requires KYC verification; Crypto/DeFi systems can be pseudonymous",
                                                "B": "Both require full identity verification",
                                                "C": "Crypto/DeFi requires more identity verification than FinTech",
                                                "D": "Neither requires any form of identity verification"
                                },
                                "correct": "A",
                                "explanation": "FinTech operates within regulatory frameworks requiring identity verification (KYC). Crypto/DeFi systems can operate pseudonymously with wallet addresses, though centralized exchanges do require KYC."
                },
                {
                                "id": 11,
                                "difficulty": "medium",
                                "question": "What is the transaction reversibility characteristic of each approach?",
                                "options": {
                                                "A": "Both allow chargebacks and reversals",
                                                "B": "FinTech allows chargebacks; Crypto/DeFi transactions are final",
                                                "C": "Crypto/DeFi allows chargebacks; FinTech transactions are final",
                                                "D": "Neither allows any form of reversal"
                                },
                                "correct": "B",
                                "explanation": "FinTech systems typically allow chargebacks and transaction reversals for consumer protection. Crypto/DeFi transactions are cryptographically final and cannot be reversed (though smart contracts can have built-in reversal logic)."
                },
                {
                                "id": 12,
                                "difficulty": "hard",
                                "question": "What custody model difference exists between FinTech and Crypto/DeFi?",
                                "options": {
                                                "A": "Both require third-party custody",
                                                "B": "FinTech uses third-party custody; Crypto/DeFi enables self-custody",
                                                "C": "Both require self-custody",
                                                "D": "FinTech enables self-custody; Crypto/DeFi requires intermediaries"
                                },
                                "correct": "B",
                                "explanation": "FinTech companies hold customer assets in custody (your bank controls your account). Crypto/DeFi enables self-custody through private keys, though centralized exchanges also offer custodial services."
                },
                {
                                "id": 13,
                                "difficulty": "medium",
                                "question": "What are the operating hours for traditional FinTech vs. Crypto/DeFi systems?",
                                "options": {
                                                "A": "Both operate 24/7/365",
                                                "B": "FinTech operates 24/7; Crypto/DeFi follows business hours",
                                                "C": "FinTech follows business hours and settlement times; Crypto/DeFi operates 24/7",
                                                "D": "Both follow standard business hours"
                                },
                                "correct": "C",
                                "explanation": "FinTech operates on traditional banking infrastructure with business hours, batch processing, and settlement delays (though some offer instant payment facades). Crypto/DeFi protocols operate continuously 24/7/365."
                },
                {
                                "id": 14,
                                "difficulty": "hard",
                                "question": "Which scalability approach is typical for each philosophy?",
                                "options": {
                                                "A": "FinTech scales through infrastructure; Crypto/DeFi faces blockchain scalability challenges",
                                                "B": "Crypto/DeFi has unlimited scalability; FinTech is severely limited",
                                                "C": "Both face identical scalability constraints",
                                                "D": "Neither can scale effectively"
                                },
                                "correct": "A",
                                "explanation": "FinTech can scale by adding traditional infrastructure (servers, databases), though it faces cost barriers. Crypto/DeFi faces blockchain scalability trilemma challenges (Layer 2s and sharding are solutions being developed)."
                },
                {
                                "id": 15,
                                "difficulty": "medium",
                                "question": "Which technology stack does FinTech primarily use?",
                                "options": {
                                                "A": "Blockchain, smart contracts, consensus mechanisms",
                                                "B": "APIs, cloud computing, mobile apps, machine learning",
                                                "C": "Distributed ledgers and cryptographic protocols",
                                                "D": "Peer-to-peer networks and token economics"
                                },
                                "correct": "B",
                                "explanation": "FinTech leverages APIs, cloud computing, mobile apps, machine learning, and big data—building on traditional infrastructure. Crypto/DeFi uses blockchain, smart contracts, consensus mechanisms, and cryptography."
                },
                {
                                "id": 16,
                                "difficulty": "hard",
                                "question": "What innovation speed tradeoff exists between the two approaches?",
                                "options": {
                                                "A": "FinTech is faster to market using existing rails; Crypto/DeFi is slower building new infrastructure",
                                                "B": "Crypto/DeFi is faster to market; FinTech is slower",
                                                "C": "Both have identical innovation speeds",
                                                "D": "Neither can innovate quickly"
                                },
                                "correct": "A",
                                "explanation": "FinTech can iterate faster by leveraging existing infrastructure and clear regulations. Crypto/DeFi must build new infrastructure and navigate regulatory uncertainty, but may enable innovations impossible on traditional rails."
                },
                {
                                "id": 17,
                                "difficulty": "easy",
                                "question": "What does the 'convergence zone' between FinTech and Crypto/DeFi represent?",
                                "options": {
                                                "A": "Companies like PayPal and Stripe blending both philosophies by adding crypto features",
                                                "B": "Complete separation between traditional finance and blockchain",
                                                "C": "Government regulation forcing all companies to choose one approach",
                                                "D": "The decline of both FinTech and Crypto/DeFi sectors"
                                },
                                "correct": "A",
                                "explanation": "Increasingly, FinTech companies are adding crypto features (PayPal offering crypto services, Stripe accepting USDC) and traditional institutions are exploring blockchain, creating a hybrid convergence zone where lines between the philosophies blur."
                },
                {
                                "id": 18,
                                "difficulty": "medium",
                                "question": "Classify this innovation: 'A mobile app that rounds up purchases and invests the change in ETFs'",
                                "options": {
                                                "A": "Pure FinTech",
                                                "B": "Pure Crypto/DeFi",
                                                "C": "Hybrid approach",
                                                "D": "Neither FinTech nor Crypto"
                                },
                                "correct": "A",
                                "explanation": "This is pure FinTech (examples: Acorns, Stash). It uses traditional brokerage infrastructure, bank accounts, and ETFs—all existing financial rails with a better UX layer."
                },
                {
                                "id": 19,
                                "difficulty": "medium",
                                "question": "Classify this innovation: 'A protocol that lets you earn interest by lending stablecoins via smart contracts'",
                                "options": {
                                                "A": "Pure FinTech",
                                                "B": "Pure Crypto/DeFi",
                                                "C": "Hybrid approach",
                                                "D": "Neither FinTech nor Crypto"
                                },
                                "correct": "B",
                                "explanation": "This is pure Crypto/DeFi (examples: Aave, Compound). It uses smart contracts, blockchain settlement, and operates without traditional financial intermediaries."
                },
                {
                                "id": 20,
                                "difficulty": "hard",
                                "question": "What is the fundamental fork that distinguishes FinTech from Crypto/DeFi?",
                                "options": {
                                                "A": "Mobile-first vs. desktop-first design",
                                                "B": "Improve the existing system vs. replace the system",
                                                "C": "B2B vs. B2C business models",
                                                "D": "Domestic vs. international focus"
                                },
                                "correct": "B",
                                "explanation": "The fundamental fork is philosophical: FinTech seeks to improve existing financial infrastructure with better UX and processes, while Crypto/DeFi aims to replace it with new trustless, decentralized infrastructure."
                }
]
        };

        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            displayedQuestions: [],
            pendingSlots: []
        };

        const questionsRow = document.getElementById('questionsRow');
        const progressBar = document.getElementById('progressBar');
        const progressBadge = document.getElementById('progressBadge');
        const scoreBadge = document.getElementById('scoreBadge');
        const resultsCard = document.getElementById('resultsCard');
        const nextBtn = document.getElementById('nextBtn');

        function initQuiz() {
            state.currentIndex = 0;
            state.answers = {};
            state.score = 0;
            state.displayedQuestions = [];
            state.pendingSlots = [];

            resultsCard.classList.remove('show');
            questionsRow.style.display = 'grid';
            nextBtn.classList.remove('show');

            // Show first 3 questions
            for (let i = 0; i < 3 && i < quizData.questions.length; i++) {
                state.displayedQuestions.push(i);
            }
            state.currentIndex = Math.min(3, quizData.questions.length);

            renderQuestions();
            updateStats();
        }

        function renderQuestions() {
            questionsRow.innerHTML = '';

            state.displayedQuestions.forEach((qIdx, slot) => {
                const q = quizData.questions[qIdx];
                const answered = state.answers[q.id] !== undefined;
                const isCorrect = answered && state.answers[q.id] === q.correct;
                const isIncorrect = answered && state.answers[q.id] !== q.correct;

                const card = document.createElement('div');
                card.className = 'question-card';
                if (isCorrect) card.classList.add('correct-card', 'answered');
                if (isIncorrect) card.classList.add('incorrect-card', 'answered');

                card.innerHTML = `
                    <div class="q-header">
                        <span class="q-number">Q${qIdx + 1}</span>
                        ${answered ? `<span class="q-status">${isCorrect ? '&#10004;' : '&#10008;'}</span>` : ''}
                    </div>
                    <div class="q-text">${q.question}</div>
                    <div class="options" data-qid="${q.id}" data-slot="${slot}">
                        ${['A','B','C','D'].map(letter => {
                            let optClass = 'option-btn';
                            if (answered) {
                                optClass += ' disabled';
                                if (letter === q.correct) optClass += ' correct';
                                else if (letter === state.answers[q.id]) optClass += ' incorrect';
                            }
                            return `
                                <button class="${optClass}" data-letter="${letter}" ${answered ? 'disabled' : ''}>
                                    <span class="option-letter">${letter}</span>
                                    <span class="option-text">${q.options[letter]}</span>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    <div class="feedback ${answered ? 'show' : ''} ${isCorrect ? 'correct' : 'incorrect'}">
                        ${answered ? (isCorrect ? '&#10004; ' : `&#10008; Answer: ${q.correct}. `) + q.explanation : ''}
                    </div>
                `;

                // Add click handlers
                if (!answered) {
                    card.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => handleAnswer(qIdx, slot, btn.dataset.letter));
                    });
                }

                questionsRow.appendChild(card);
            });

            renderMath();
        }

        function handleAnswer(qIdx, slot, letter) {
            const q = quizData.questions[qIdx];
            state.answers[q.id] = letter;

            if (letter === q.correct) state.score++;

            // Track this slot as pending replacement
            if (!state.pendingSlots.includes(slot)) {
                state.pendingSlots.push(slot);
            }

            updateStats();
            renderQuestions();

            // Check if all questions answered
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                // Short delay then show results
                setTimeout(showResults, 800);
            } else if (state.currentIndex < quizData.questions.length && state.pendingSlots.length > 0) {
                // Show Next button if there are more questions and pending slots
                nextBtn.classList.add('show');
            }
        }

        function loadNextQuestions() {
            // Replace pending slots with new questions
            while (state.pendingSlots.length > 0 && state.currentIndex < quizData.questions.length) {
                const slot = state.pendingSlots.shift();
                state.displayedQuestions[slot] = state.currentIndex;
                state.currentIndex++;
            }

            // Hide Next button
            nextBtn.classList.remove('show');

            renderQuestions();

            // Check if quiz is complete (all displayed questions answered)
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                setTimeout(showResults, 500);
            }
        }

        function updateStats() {
            const answered = Object.keys(state.answers).length;
            const total = quizData.questions.length;

            progressBar.style.width = `${(answered / total) * 100}%`;
            progressBadge.textContent = `${answered}/${total}`;
            scoreBadge.textContent = `Score: ${state.score}`;
        }

        function showResults() {
            questionsRow.style.display = 'none';
            nextBtn.classList.remove('show');
            resultsCard.classList.add('show');

            const total = quizData.questions.length;
            const percentage = Math.round((state.score / total) * 100);

            document.getElementById('resultsScore').textContent = `${state.score}/${total}`;

            let grade, gradeClass, icon;
            if (percentage >= 90) { grade = 'Excellent! A'; gradeClass = 'grade-a'; icon = '&#127942;'; }
            else if (percentage >= 80) { grade = 'Great! B'; gradeClass = 'grade-b'; icon = '&#11088;'; }
            else if (percentage >= 70) { grade = 'Good! C'; gradeClass = 'grade-c'; icon = '&#128077;'; }
            else if (percentage >= 60) { grade = 'Pass - D'; gradeClass = 'grade-d'; icon = '&#128221;'; }
            else { grade = 'Keep practicing'; gradeClass = 'grade-f'; icon = '&#128218;'; }

            document.getElementById('resultsIcon').innerHTML = icon;
            const gradeEl = document.getElementById('resultsGrade');
            gradeEl.textContent = `${grade} (${percentage}%)`;
            gradeEl.className = `results-grade ${gradeClass}`;
        }

        function restartQuiz() {
            initQuiz();
        }

        function renderMath() {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initQuiz();
            setTimeout(renderMath, 100);
        });
    </script>
</body>
</html>
